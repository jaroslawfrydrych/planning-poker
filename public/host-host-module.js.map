{"version":3,"sources":["./src/app/poker/host/host.service.ts","./src/app/poker/host/host.module.ts","./src/app/poker/host/board/board.resolver.ts","./src/app/poker/host/host-routing.module.ts","./src/app/poker/host/board/board.component.ts","./src/app/poker/host/board/board.component.html"],"names":[],"mappings":"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","file":"host-host-module.js","sourcesContent":["import { Injectable } from '@angular/core';\nimport {\n  Client,\n  ClientType,\n  GameStateBroadcastDto,\n  GameStates,\n  RoomInfoInterface,\n  UsersResponseDto\n} from '@planning-poker/api-interfaces';\nimport { BehaviorSubject, interval, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { PokerService } from '../services/poker.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class HostService {\n\n  public gameState$: Observable<GameStates>;\n  private gameStateSubject$: BehaviorSubject<GameStates>;\n\n  constructor(private pokerService: PokerService) {\n    this.gameStateSubject$ = new BehaviorSubject<GameStates>(GameStates.IN_PROGRESS);\n    this.gameState$ = this.gameStateSubject$.asObservable();\n  }\n\n  public getUsers(): Observable<Client[]> {\n    return this.pokerService.getUsers()\n      .pipe(\n        map((response: UsersResponseDto) => {\n          return response.clients;\n        })\n      );\n  }\n\n  public toggleGameState(roomId: string): void {\n    this.pokerService.toggleGameState(roomId);\n  }\n\n  public currentTime(): Observable<Date> {\n    return interval(1000)\n      .pipe(\n        map(() => new Date())\n      );\n  }\n\n  public createRoom(): Observable<RoomInfoInterface> {\n    return this.pokerService.createRoom();\n  }\n\n  public getGameState(): Observable<GameStateBroadcastDto> {\n    return this.pokerService.receiveGameState();\n  }\n\n  public joinRoom(room: string): void {\n    this.pokerService.joinRoom(room, ClientType.HOST);\n  }\n}\n\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { SharedModule } from '../../shared/shared.module';\nimport { BoardComponent } from './board/board.component';\nimport { HostRoutingModule } from './host-routing.module';\n\n@NgModule({\n  declarations: [BoardComponent],\n  imports: [\n    CommonModule,\n    HostRoutingModule,\n    SharedModule\n  ]\n})\nexport class HostModule {\n}\n","import { Injectable } from '@angular/core';\nimport { Resolve } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { RoomInfoInterface } from '../../../../../../../libs/api-interfaces/src';\nimport { HostService } from '../host.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class BoardResolver implements Resolve<RoomInfoInterface> {\n\n  constructor(private readonly hostService: HostService) {\n  }\n\n  public resolve(): Observable<RoomInfoInterface> {\n    return this.hostService.createRoom();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { BoardComponent } from './board/board.component';\nimport { BoardResolver } from './board/board.resolver';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: BoardComponent,\n    resolve: {\n      data: BoardResolver\n    }\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class HostRoutingModule {\n}\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport {\n  Client,\n  ClientType,\n  GameStateBroadcastDto,\n  GameStates,\n  RoomInfoInterface,\n  UserStatuses\n} from '@planning-poker/api-interfaces';\nimport { ButtonColor } from '@shared/button/button-color.enum';\nimport { GoogleAnalyticsService } from 'ngx-google-analytics';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { map, tap } from 'rxjs/operators';\nimport { HostService } from '../host.service';\n\n@Component({\n  selector: 'planning-poker-board',\n  templateUrl: './board.component.html',\n  styleUrls: ['./board.component.scss']\n})\nexport class BoardComponent implements OnInit, OnDestroy {\n\n  public roomId: string;\n  public users$: Observable<Client[]>;\n  public userStatues = UserStatuses;\n  public gameState$: Observable<GameStates>;\n  public gameStates = GameStates;\n  public buttonColors = ButtonColor;\n  public reviewCardsSubject$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  public currentTime$: Observable<Date>;\n  private onDestroySubject: Subject<null> = new Subject<null>();\n\n  constructor(private hostService: HostService,\n              private activatedRoute: ActivatedRoute,\n              private $gaService: GoogleAnalyticsService) {\n  }\n\n  public ngOnInit(): void {\n    const resolverData: RoomInfoInterface = this.activatedRoute.snapshot.data.data;\n    this.roomId = resolverData.id;\n    this.hostService.joinRoom(this.roomId);\n\n    this.users$ = this.hostService.getUsers()\n      .pipe(\n        map((users: Client[]) => {\n          return users.filter((user: Client) => user.type === ClientType.VOTER);\n        })\n      );\n\n    this.currentTime$ = this.hostService.currentTime();\n    this.gameState$ = this.hostService.getGameState()\n      .pipe(\n        map((data: GameStateBroadcastDto) => data.state),\n        tap((gameState: GameStates) => this.handleGameStateChange(gameState))\n      );\n  }\n\n  public ngOnDestroy(): void {\n    this.onDestroySubject.next(null);\n  }\n\n  public toggleGameState(): void {\n    this.hostService.toggleGameState(this.roomId);\n    this.$gaService.event('toggle_game_state', 'host', 'Toggle game state');\n  }\n\n  private handleGameStateChange(gameState: GameStates): void {\n    this.reviewCardsSubject$.next(gameState === GameStates.REVIEW);\n  }\n}\n","<header>\n  <h1>ROOM ID: {{roomId}}</h1>\n  <span class=\"clock\">{{currentTime$ | async | date:'HH:mm'}}</span>\n</header>\n\n<div class=\"cards\">\n  <ng-container *ngFor=\"let user of users$ | async\">\n    <planning-poker-card [boardCard]=\"true\"\n                         [review]=\"reviewCardsSubject$ | async\"\n                         [card]=\"user.card\"\n                         [label]=\"user.name\"\n                         [playerReady]=\"user.status === userStatues.VOTED\"></planning-poker-card>\n  </ng-container>\n</div>\n\n<footer>\n  <button planningPokerButton\n          class=\"toggle-game-state\"\n          [buttonColor]=\"buttonColors.SECONDARY\"\n          [ngSwitch]=\"gameState$ | async\"\n          (click)=\"toggleGameState()\">\n    <ng-container *ngSwitchCase=\"gameStates.REVIEW\">New voting</ng-container>\n    <ng-container *ngSwitchDefault>Finish Voting</ng-container>\n  </button>\n</footer>\n"],"sourceRoot":"webpack:///"}